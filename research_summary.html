<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mind Map</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    
    #markmap {
      width: 100%;
      height: 100vh;
    }
    
    /* 主题样式 */
    [data-theme="light"] {
      background-color: #ffffff;
    }
    
    [data-theme="dark"] {
      background-color: #1a1a1a;
    }
    
    [data-theme="dark"] .markmap-node-text {
      fill: #e0e0e0;
    }
    
    [data-theme="dark"] .markmap-link {
      stroke: #666;
    }
    
    /* 控制面板样式 */
    .controls {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      gap: 10px;
      z-index: 1000;
    }
    
    [data-theme="dark"] .controls {
      background: rgba(40, 40, 40, 0.95);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }
    
    .controls button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    
    .controls button:hover {
      background: #45a049;
    }
    
    .controls button:active {
      transform: scale(0.98);
    }
    
    /* 加载动画 */
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      color: #666;
    }
    
    [data-theme="dark"] .loading {
      color: #aaa;
    }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-view@0.18.9/dist/index.css">
</head>
<body>
  <svg id="markmap"></svg>
  
  <div class="controls">
    <button onclick="mm.fit()">适应屏幕</button>
    <button onclick="expandAll()">展开全部</button>
    <button onclick="collapseAll()">收起全部</button>
    <button onclick="toggleTheme()">切换主题</button>
  </div>
  
  <div class="loading" id="loading">加载中...</div>

  <!-- Markmap 依赖 -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.9"></script>
  
  <script>
    // 初始化数据
    const data = {"type":"heading","depth":0,"payload":{"id":"root","maxWidth":0},"content":"Root","children":[]};
    const options = {};
    
    // 创建 Markmap 实例
    let mm;
    
    function initMarkmap() {
      const { Markmap } = window.markmap;
      
      // 移除加载提示
      document.getElementById('loading').style.display = 'none';
      
      // 创建并渲染 Markmap
      mm = Markmap.create('#markmap', {
        ...options,
        duration: 500,
        nodeFont: '300 16px/20px sans-serif',
        nodeMinHeight: 16,
        spacingVertical: 5,
        spacingHorizontal: 80,
        autoFit: true,
        fitRatio: 0.95,
        paddingX: 8,
        scrollForPan: true,
        nodeTextOverflow: 'wrap',
      });
      
      mm.setData(data);
      mm.fit();
    }
    
    // 展开所有节点
    function expandAll() {
      if (!mm) return;
      function expand(node) {
        if (node.children) {
          node.payload = { ...node.payload, fold: 0 };
          node.children.forEach(expand);
        }
      }
      expand(data);
      mm.setData(data);
    }
    
    // 收起所有节点
    function collapseAll() {
      if (!mm) return;
      function collapse(node, level = 0) {
        if (node.children && level > 0) {
          node.payload = { ...node.payload, fold: 1 };
          node.children.forEach(child => collapse(child, level + 1));
        } else if (node.children) {
          node.children.forEach(child => collapse(child, level + 1));
        }
      }
      collapse(data);
      mm.setData(data);
    }
    
    // 切换主题
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', newTheme);
    }
    
    // 等待 DOM 加载完成后初始化
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMarkmap);
    } else {
      initMarkmap();
    }
    
    // 监听窗口大小变化
    window.addEventListener('resize', () => {
      if (mm) mm.fit();
    });
  </script>
</body>
</html>